<div class="reset-card">
  <h2>Réinitialiser votre mot de passe</h2>

  <form (ngSubmit)="confirmReset()" #resetForm="ngForm">
    <!-- Champ nouveau mot de passe -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nouveau mot de passe</mat-label>
      <input
        matInput
        [type]="hideNewPassword ? 'password' : 'text'"
        name="newPassword"
        [(ngModel)]="newPassword"
        required
        #newPasswordInput="ngModel"
      />
      <button
        mat-icon-button
        matSuffix
        type="button"
        (click)="hideNewPassword = !hideNewPassword"
        [attr.aria-label]="'Afficher ou masquer le mot de passe'"
        [attr.aria-pressed]="!hideNewPassword"
      >
        <mat-icon>{{
          hideNewPassword ? "visibility_off" : "visibility"
        }}</mat-icon>
      </button>
      <mat-error *ngIf="newPasswordInput.invalid && newPasswordInput.touched">
        Ce champ est requis
      </mat-error>
    </mat-form-field>

    <!-- Champ confirmation mot de passe -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Confirmer le mot de passe</mat-label>
      <input
        matInput
        [type]="hideConfirmPassword ? 'password' : 'text'"
        name="confirmPassword"
        [(ngModel)]="confirmPassword"
        required
        #confirmPasswordInput="ngModel"
      />
      <button
        mat-icon-button
        matSuffix
        type="button"
        (click)="hideConfirmPassword = !hideConfirmPassword"
        [attr.aria-label]="'Afficher ou masquer le mot de passe'"
        [attr.aria-pressed]="!hideConfirmPassword"
      >
        <mat-icon>{{
          hideConfirmPassword ? "visibility_off" : "visibility"
        }}</mat-icon>
      </button>
      <mat-error
        *ngIf="confirmPasswordInput.invalid && confirmPasswordInput.touched"
      >
        Ce champ est requis
      </mat-error>
    </mat-form-field>

    <!-- ✅ Vérification dynamique des mots de passe -->
    <div
      class="mat-error"
      *ngIf="
        confirmPasswordInput.touched &&
        confirmPassword &&
        newPassword &&
        confirmPassword !== newPassword
      "
    >
      Les mots de passe ne correspondent pas
    </div>

    <!-- Boutons d’action -->
    <div class="actions">
      <button mat-stroked-button color="warn" type="button" (click)="annuler()">
        Annuler
      </button>

      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="resetForm.invalid || confirmPassword !== newPassword"
      >
        Valider
      </button>
    </div>

    <!-- Messages de succès / erreur -->
    <div *ngIf="message" class="success-message">
      {{ message }}
    </div>
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>
  </form>
</div>
